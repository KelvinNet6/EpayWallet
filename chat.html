<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat | PaySheet</title>
    <link rel="icon" href="screenshot_2025_02_06_14_53_13_QDM_icon.ico" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>
<body>
    <button class="menu-btn" id="menu-btn">☰</button>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="home.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="transferfunds.html"><i class="fas fa-exchange-alt"></i> TF</a></li>
            <li><a href="cashout.html"><i class="fas fa-money-check-alt"></i> Cash Out</a></li>
            <li><a href="profilesettings.html"><i class="fas fa-cogs"></i> Account Settings</a></li>
            <li><button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Sign Out</button></li>
        </ul>
    </div>

    <!-- Main Content for AI Chat -->
    <div class="main-content" id="chat">
        <header class="header">
            <h1>AI Chat | PaySheet</h1>
            <p>AI Assistance</p>
        </header>   
        <!-- Chat Window -->
        <div class="chat-window" id="chat-window">
            <!-- Automatic Greeting and Messages -->
        </div>

        <!-- User Input Field -->
        <div class="user-input">
            <input type="text" id="user-query" placeholder="Type your question here..." />
            <button id="send-btn">Send</button>
        </div>

    <script>
        // Toggle Sidebar for Mobile
        document.getElementById("menu-btn").addEventListener("click", () => {
            const sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("active");
        });

        // Logout functionality
        document.getElementById("logout-btn").addEventListener("click", () => {
            localStorage.removeItem('authToken');
            window.location.href = "index.html";
        });

        // Add message function to display chat bubbles
        function addMessage(sender, message) {
            const chatWindow = document.getElementById("chat-window");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("chat-bubble", sender === "ai" ? "ai-bubble" : "user-bubble");
            messageDiv.innerHTML = `<p>${message}</p>`;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight; // Scroll to the latest message
        }

       // Simulate automatic AI greeting and suggestions
window.addEventListener('load', function() {
    setTimeout(function() {
        // Construct the greeting message with available services
       let greetingMessage = "Hello! I'm PaySheet AI assistant.<br>";
       greetingMessage += "I can assist you with the following:<br><br>";
       greetingMessage += "1. Check your PaySheet Number<br>";
       greetingMessage += "2. Check PaySheet Balance<br>";
       greetingMessage += "3. Transfer Fee Charges<br>";
       greetingMessage += "4. Cashout Fee Charges<br>";
       greetingMessage += "5. Locating nearest Payment Collection Agent<br>";
       greetingMessage += "6. Transaction Monitoring";


        // Add the message to the chat (assuming addMessage function adds messages to a UI)
        addMessage('ai', greetingMessage);
    }, 1000); // AI greets the user after 1 second
});

        // Handle user input and AI responses
document.getElementById("send-btn").addEventListener("click", function() {
    const userInput = document.getElementById("user-query").value;
    if (userInput.trim()) {
        addMessage('user', userInput);  // Display the user's message

        // AI response logic based on user input
        let aiResponse = '';

        if (userInput.toLowerCase().includes('balance')) {
            // Fetch balance using the integrated API
            aiResponse = 'Fetching your balance...';
            setTimeout(function() {
                fetchBalance();  // Call the function to get the balance
            }, 1000);
            return;
        }
        else if (userInput.toLowerCase().includes('hi') || userInput.toLowerCase().includes('hello')) {
            // Respond to greetings (Hi or Hello)
            aiResponse = 'Hello! How can I help you today?';
        }
        // Checking for transaction rate-related questions
        else if (userInput.toLowerCase().includes('transfer fee')) {
            aiResponse = 'Our standard transaction fee is 2% per transfer. For international transfers, there is an additional $5 charge.';
        } else if (userInput.toLowerCase().includes('withdrawal fee') || userInput.toLowerCase().includes('cash out fee')) {
            aiResponse = 'The withdrawal fee for cashing out is $1.50 per transaction.';
        } else if (userInput.toLowerCase().includes('currency conversion fee')) {
            aiResponse = 'Currency conversion is charged at a rate of 1.5% for each transaction involving different currencies.';
        } else if (userInput.toLowerCase().includes('nearest agent') || userInput.toLowerCase().includes('find payment agent')) {
            // Ask the user for their location to find the nearest payment collection agent
            aiResponse = 'I can help you find the nearest payment collection agent. Please share your location (city or use your current location).';
            setTimeout(function() {
                addMessage('ai', aiResponse);
            }, 1000);
            return;
        } else if (userInput.toLowerCase().includes('location')) {
            // Retrieve the user’s location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // Use the lat/lon to find the nearest payment collection agents (dummy data for this example)
                    const nearestAgents = findNearestAgent(lat, lon);
                    aiResponse = `I found the nearest agents to your location:\n` + nearestAgents.map(agent => `${agent.name} - ${agent.distance} km away`).join('\n');

                    setTimeout(function() {
                        addMessage('ai', aiResponse);
                    }, 1000);
                }, function() {
                    aiResponse = "Sorry, I couldn't retrieve your location. Please enter a city.";
                    setTimeout(function() {
                        addMessage('ai', aiResponse);
                    }, 1000);
                });
            } else {
                aiResponse = "Geolocation is not supported by this browser. Please enter a city name.";
                setTimeout(function() {
                    addMessage('ai', aiResponse);
                }, 1000);
            }
            return;
        } else {
            aiResponse = 'I didn\'t quite understand that. Could you try again?';
        }

        setTimeout(function() {
            addMessage('ai', aiResponse);  // Display the AI's response
        }, 1000); // AI responds after 1 second

        document.getElementById("user-query").value = '';  // Clear the input field
    }
});

// Function to fetch balance from the integrated API
function fetchBalance() {
    // Simulating an API request for the balance
    // Replace with your actual API request code
    fetch('/api/getBalance')  // Assuming you have an API endpoint like '/api/getBalance'
        .then(response => response.json())
        .then(data => {
            const balance = data.balance;  // Assume the response contains a 'balance' field
            addMessage('ai', `Your current wallet balance is $${balance}.`);
        })
        .catch(error => {
            addMessage('ai', 'Sorry, there was an error fetching your balance. Please try again later.');
        });
}

// Dummy function to simulate finding nearest payment agents based on location (latitude, longitude)
function findNearestAgent(lat, lon) {
    // Simulated data for nearest agents
    const agents = [
        { name: "Agent 1", distance: (Math.random() * 5).toFixed(2) },
        { name: "Agent 2", distance: (Math.random() * 10).toFixed(2) },
        { name: "Agent 3", distance: (Math.random() * 3).toFixed(2) }
    ];
    return agents;
}

    </script>
</body>
</html>
